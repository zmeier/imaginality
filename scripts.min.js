function onLoaded(){createToolbox()}function createToolbox(){var t=document.getElementById("drawing-canvas"),e=document.getElementById("saving-canvas"),o=document.getElementById("toolbox-tools"),i=document.getElementById("toolbox-styles");toolbox=new Toolbox(t,e,o,i)}function sliderchanged(){var t=document.getElementById("canvas-zoom-range"),e=document.getElementById("canvas-zoom-level"),o=t.value;e.value=o,toolbox.updateWithZoom(+o)}function changeZoom(){var t=document.getElementById("canvas-zoom-range"),e=document.getElementById("canvas-zoom-level"),o=e.value;+o>=+t.min&&+o<=+t.max?(t.value=o,toolbox.updateWithZoom(+o)):e.value=t.value}function saveImage(){toolbox.saveImage()}function addEventHandler(t,e,o){t.addEventListener(e,o,!1)}function getMousePosition(t,e,o){void 0===o&&(o=100);var i=t.getBoundingClientRect(),n=(e.clientX-i.left)*(100/o),s=(e.clientY-i.top)*(100/o);return{x:Math.round(n),y:Math.round(s)}}function getContextImgData(t){return t.getImageData(0,0,t.canvas.width,t.canvas.height)}function clearCanvas(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}var toolbox,Toolbox=function(){function t(t,e,o,i){this.__selectedToolIdx=null,this.__styleSettings=new StyleSettings,this.__canvas=t,this.__savingCanvas=e;var n=this.__canvas.parentElement;this.__origWidth=n.clientWidth-10,this.__origHeight=n.clientHeight-12,this.setCanvasWidth(this.__canvas,this.__origWidth,this.__origHeight),this.setCanvasWidth(this.__savingCanvas,this.__origWidth,this.__origHeight),this.__context=this.__canvas.getContext("2d"),this.__savingContext=this.__savingCanvas.getContext("2d"),this.__toolboxElem=o,this.__toolboxStylesElem=i,this.createToolbox(),window.addEventListener("click",function(t){ToolboxHelper.closeMenu()},!0),this.addCanvasEventHandlers(),this.updateContextWithStyles(this.__context)}return t.prototype.updateWithZoom=function(t){getContextImgData(this.__context);this.__canvas.style.width=this.__origWidth*(t/100)+"px",this.__canvas.style.height=this.__origHeight*(t/100)+"px",this.__prevZoom=t},t.prototype.saveImage=function(){var t=this.__savingCanvas.toDataURL();window.open(t)},t.prototype.setCanvasWidth=function(t,e,o){t.width=e,t.height=o},t.prototype.addCanvasEventHandlers=function(){var t=this;addEventHandler(this.__canvas,"mousedown",function(e){t&&t.__tools&&null!==t.__selectedToolIdx&&t.__tools[t.__selectedToolIdx].mouseDown(getMousePosition(t.__canvas,e,t.__prevZoom),t.__context,t.__savingContext)}),addEventHandler(this.__canvas,"mousemove",function(e){var o=document.getElementById("canvas-pos-x"),i=document.getElementById("canvas-pos-y"),n=getMousePosition(t.__canvas,e,t.__prevZoom);o&&i&&n&&(o.innerText="x: "+n.x,i.innerText="y: "+n.y),t&&t.__tools&&null!==t.__selectedToolIdx&&t.__tools[t.__selectedToolIdx].mouseMove(n,t.__context,t.__savingContext)}),addEventHandler(this.__canvas,"mouseup",function(e){t&&t.__tools&&null!==t.__selectedToolIdx&&t.__tools[t.__selectedToolIdx].mouseUp(getMousePosition(t.__canvas,e,t.__prevZoom),t.__context,t.__savingContext)}),addEventHandler(window,"keydown",function(e){t&&t.__tools&&null!==t.__selectedToolIdx&&t.__tools[t.__selectedToolIdx].keyPress(e,t.__context,t.__savingContext)}),addEventHandler(window,"mouseout",function(e){var o=document.getElementById("canvas-pos-x"),i=document.getElementById("canvas-pos-y");o&&i&&(o.innerText="x: ",i.innerText="y: "),t&&t.__tools&&null!==t.__selectedToolIdx&&t.__tools[t.__selectedToolIdx].mouseUp(getMousePosition(t.__canvas,e,t.__prevZoom),t.__context,t.__savingContext)})},t.prototype.updateContextWithStyles=function(t){t.lineWidth=this.__styleSettings.stroke.weight,t.strokeStyle=this.__styleSettings.stroke.color,t.fillStyle=this.__styleSettings.fillColor,t.font=this.__styleSettings.font.size+"px "+this.__styleSettings.font.name},t.prototype.createToolbox=function(){this.__tools=[new Cursor(this.__styleSettings),new Pencil(this.__styleSettings),new Line(this.__styleSettings),new Scribble(this.__styleSettings),new Square(this.__styleSettings),new Circle(this.__styleSettings),new TextTool(this.__styleSettings),new Eraser(this.__styleSettings)],this.__selectedToolIdx=0;for(var t=0;t<this.__tools.length;t++){var e=this.__tools[t],o=document.createElement("button");o.setAttribute("id","toolboxbutton_"+t);var i="toolbox-button";t===this.__selectedToolIdx&&(i+=" selected"),o.setAttribute("class",i);var n=e.svgIcon;n?o.innerHTML=n:o.innerText=e.altText,this.__toolboxElem.appendChild(o),this.addToolboxClickHandler(o,t)}this.createToolboxStyles()},t.prototype.addToolboxClickHandler=function(t,e){var o=this;t.addEventListener("click",function(){o.toolboxButtonClicked(e)},!1)},t.prototype.toolboxButtonClicked=function(t){if(null!==this.__selectedToolIdx){this.__tools[this.__selectedToolIdx].stopDrawing(this.__context,this.__savingContext);var e=document.getElementById("toolboxbutton_"+this.__selectedToolIdx);e.className="toolbox-button"}var o=document.getElementById("toolboxbutton_"+t);o.className+=" selected",this.__selectedToolIdx=t},t.prototype.createToolboxStyles=function(){this.__toolboxStylesElem.appendChild(ToolboxHelper.createStyleButton(this,"button","toolboxStylebutton_font",{class:"toolbox-button"},"Abc",{font:".75em "+this.__styleSettings.font.name},ToolboxHelper.createFontMenu)),this.__toolboxStylesElem.appendChild(ToolboxHelper.createStyleButton(this,"button","toolboxStylebutton_fontSize",{class:"toolbox-button"},""+this.__styleSettings.font.size,{fontSize:"1em"},ToolboxHelper.createFontSizeMenu)),this.__toolboxStylesElem.appendChild(ToolboxHelper.createStyleButton(this,"input","toolboxStylebutton_fillColor_input",{type:"color",style:"display: none",onchange:"toolbox.changeFillColor();"},"",{},null)),this.__toolboxStylesElem.appendChild(ToolboxHelper.createStyleButton(this,"button","toolboxStylebutton_fillColor",{class:"toolbox-button"},Fill.getFillColorSVG(null),{},function(){document.getElementById("toolboxStylebutton_fillColor_input").click()})),this.__toolboxStylesElem.appendChild(ToolboxHelper.createStyleButton(this,"input","toolboxStylebutton_strokeColor_input",{type:"color",style:"display: none",onchange:"toolbox.changeStrokeColor();"},"",{},null)),this.__toolboxStylesElem.appendChild(ToolboxHelper.createStyleButton(this,"button","toolboxStylebutton_strokeColor",{class:"toolbox-button"},Stroke.getStrokeColorSVG(this.__styleSettings.stroke.color),{},function(){document.getElementById("toolboxStylebutton_strokeColor_input").click()})),this.__toolboxStylesElem.appendChild(ToolboxHelper.createStyleButton(this,"button","toolboxStylebutton_strokeWeight",{class:"toolbox-button"},'<svg height="20" width="20"><line x1="0" y1="10" x2="20" y2="10" style="stroke:black;stroke-width:2" /></svg>',{},ToolboxHelper.createStrokeMenu)),this.__toolboxStylesElem.appendChild(ToolboxHelper.createStyleButton(this,"button","toolboxStylebutton_pixelWeight",{class:"toolbox-button"},'<svg height="20" width="20"><circle cx="10" cy="10" r="2" style="fill:black;" /></svg>',{},ToolboxHelper.createPixelWeightMenu))},t.prototype.changeStrokeColor=function(){var t=document.getElementById("toolboxStylebutton_strokeColor_input"),e=t.value;e&&(this.__styleSettings.stroke.color=e,this.__context.strokeStyle=e,document.getElementById("toolboxStylebutton_strokeColor").innerHTML=Stroke.getStrokeColorSVG(e)),this.updateContextWithStyles(this.__context)},t.prototype.changeFillColor=function(){var t=document.getElementById("toolboxStylebutton_fillColor_input"),e=t.value;e&&(this.__styleSettings.fillColor.color=e,this.__context.fillStyle=e,document.getElementById("toolboxStylebutton_fillColor").innerHTML=Fill.getFillColorSVG(e)),this.updateContextWithStyles(this.__context)},t.prototype.changeStroke=function(t,e){e.__styleSettings.stroke.weight=t,ToolboxHelper.closeMenu();var o=document.getElementById("toolboxStylebutton_strokeWeight");o.innerHTML='<svg height="20" width="20"><line x1="0" y1="10" x2="20" y2="10" style="stroke:black;stroke-width:'+t+'" /></svg>',this.updateContextWithStyles(this.__context)},t.prototype.changePixelWeight=function(t,e){e.__styleSettings.pixelWeight=t,ToolboxHelper.closeMenu();var o=document.getElementById("toolboxStylebutton_pixelWeight");o.innerHTML='<svg height="20" width="20"><circle cx="10" cy="10" r="'+t+'" style="fill:black;" /></svg>',this.updateContextWithStyles(this.__context)},t.prototype.changeFont=function(t,e){e.__styleSettings.font.name=t,ToolboxHelper.closeMenu();var o=document.getElementById("toolboxStylebutton_font");o.style.font="0.75em "+t,e.__context.font=e.__styleSettings.font.size+"px "+e.__styleSettings.font.name,this.updateContextWithStyles(this.__context)},t.prototype.changeFontSize=function(t,e){e.__styleSettings.font.size=+t,ToolboxHelper.closeMenu();var o=document.getElementById("toolboxStylebutton_fontSize");o.innerText=t,e.__context.font=e.__styleSettings.font.size+"px "+e.__styleSettings.font.name,this.updateContextWithStyles(this.__context)},t.__menuDiv=null,t}(),StyleSettings=function(){function t(t,e,o){this.fillColor=new Fill,this.stroke=new Stroke,this.font=new Font,this.pixelWeight=2,t&&(this.fillColor=t),e&&(this.stroke=e),o&&(this.font=o)}return t.noColorSVG=function(){return'<svg height="27" width="26" style="margin: 0"><line x1="0" y1="27" x2="26" y2="0" style="stroke:red ;stroke-width:2" /></svg>'},t}(),Fill=function(){function t(t){void 0===t&&(t="transparent"),this.color=t}return t.getFillColorSVG=function(t){return t?'<svg height="20" width="20"><rect x="0" y="0" width="20" height="20" rx="4" ry="4" style="stroke:black;stroke-width:1;fill:'+t+';" /></svg>':'<svg height="20" width="20"><g><line x1="19" y1="1" x2="1" y2="19" style="stroke:red ;stroke-width:2" /><rect x="0" y="0" width="20" height="20" rx="4" ry="4" style="stroke:black;stroke-width:1;fill:none;" /></g></svg>'},t}(),Stroke=function(){function t(t,e){void 0===t&&(t="black"),void 0===e&&(e=2),this.color=t,this.weight=e}return t.getStrokeColorSVG=function(t){return'<svg height="20" width="20"><line x1="0" y1="0" x2="20" y2="20" style="stroke:'+t+';stroke-width:2" /></svg>'},t}(),Font=function(){function t(t,e){void 0===t&&(t="Arial"),void 0===e&&(e=24),this.name=t,this.size=e}return t}(),ToolboxHelper=function(){function t(){}return t.createStyleButton=function(t,e,o,i,n,s,l){var a,c=document.createElement(e);c.setAttribute("id",o);for(a in i){var r=i[a];c.setAttribute(a,r)}c.innerHTML=n;for(a in s){var _=s[a];c.style.setProperty(a,_)}return l&&c.addEventListener("click",function(e){l(e,t)},!1),c},t.createMenu=function(e,o,i){var n;t.closeMenu(),t.__menuDiv=document.createElement("div"),t.__menuDiv.setAttribute("class","dropdown-menu"),t.__menuDiv.setAttribute("style","left:"+o+"px;top:"+i+"px;"),t.__menuDiv.setAttribute("tabindex","0");for(var s=0;s<e.length;s++){var l=e[s],a=document.createElement("div");a.innerHTML=l.html,a.setAttribute("class",l.class),a.addEventListener("click",l.callback,!1),a.addEventListener("keypress",l.callback,!1),a.setAttribute("tabindex","0"),t.__menuDiv.appendChild(a),0===s&&(n=a)}window.setTimeout(function(){n.focus()},0),document.body.appendChild(t.__menuDiv)},t.closeMenu=function(){t.__menuDiv&&(document.body.removeChild(t.__menuDiv),t.__menuDiv=null)},t.createStrokeMenu=function(e,o){var i=[{html:'<svg height="20" width="50"><line x1="2" y1="10" x2="48" y2="10" style="stroke:black;stroke-width:2" /></svg>',class:"dropdown-button",callback:function(){o.changeStroke(2,o)}},{html:'<svg height="20" width="50"><line x1="2" y1="10" x2="48" y2="10" style="stroke:black;stroke-width:4" /></svg>',class:"dropdown-button",callback:function(){o.changeStroke(4,o)}},{html:'<svg height="20" width="50"><line x1="2" y1="10" x2="48" y2="10" style="stroke:black;stroke-width:6" /></svg>',class:"dropdown-button",callback:function(){o.changeStroke(6,o)}},{html:'<svg height="20" width="50"><line x1="2" y1="10" x2="48" y2="10" style="stroke:black;stroke-width:8" /></svg>',class:"dropdown-button",callback:function(){o.changeStroke(8,o)}},{html:'<svg height="20" width="50"><line x1="2" y1="10" x2="48" y2="10" style="stroke:black;stroke-width:10" /></svg>',class:"dropdown-button",callback:function(){o.changeStroke(10,o)}}],n=document.getElementById("toolboxStylebutton_strokeWeight").getBoundingClientRect();t.createMenu(i,n.left,n.bottom)},t.createPixelWeightMenu=function(e,o){var i=[{html:'<svg height="20" width="20"><circle cx="10" cy="10" r="1" style="fill:black;" /></svg>',class:"dropdown-button",callback:function(){o.changePixelWeight(1,o)}},{html:'<svg height="20" width="20"><circle cx="10" cy="10" r="2" style="fill:black;" /></svg>',class:"dropdown-button",callback:function(){o.changePixelWeight(2,o)}},{html:'<svg height="20" width="20"><circle cx="10" cy="10" r="4" style="fill:black;" /></svg>',class:"dropdown-button",callback:function(){o.changePixelWeight(4,o)}},{html:'<svg height="20" width="20"><circle cx="10" cy="10" r="6" style="fill:black;" /></svg>',class:"dropdown-button",callback:function(){o.changePixelWeight(6,o)}},{html:'<svg height="20" width="20"><circle cx="10" cy="10" r="8" style="fill:black;" /></svg>',class:"dropdown-button",callback:function(){o.changePixelWeight(8,o)}},{html:'<svg height="20" width="20"><circle cx="10" cy="10" r="10" style="fill:black;" /></svg>',class:"dropdown-button",callback:function(){o.changePixelWeight(10,o)}}],n=document.getElementById("toolboxStylebutton_pixelWeight").getBoundingClientRect();t.createMenu(i,n.left,n.bottom)},t.createFontMenu=function(e,o){var i=[{html:'<div style="font-family:Arial">Arial</div>',class:"dropdown-button",callback:function(){o.changeFont("arial",o)}},{html:'<div style="font-family:Arial Black">Arial Black</div>',class:"dropdown-button",callback:function(){o.changeFont("arial black",o)}},{html:'<div style="font-family:Comic Sans MS">Comic Sans MS</div>',class:"dropdown-button",callback:function(){o.changeFont("comic sans ms",o)}},{html:'<div style="font-family:Tahoma">Tahoma</div>',class:"dropdown-button",callback:function(){o.changeFont("Tahoma",o)}},{html:'<div style="font-family:Courier New">Courier New</div>',class:"dropdown-button",callback:function(){o.changeFont("Courier New",o)}},{html:'<div style="font-family:Lucida Console">Lucida Console</div>',class:"dropdown-button",callback:function(){o.changeFont("Lucida Console",o)}}],n=document.getElementById("toolboxStylebutton_font").getBoundingClientRect();t.createMenu(i,n.left,n.bottom)},t.createFontSizeMenu=function(e,o){var i=[{html:'<div style="font-size:12px">12</div>',class:"dropdown-button",callback:function(){o.changeFontSize("12",o)}},{html:'<div style="font-size:16px">16</div>',class:"dropdown-button",callback:function(){o.changeFontSize("16",o)}},{html:'<div style="font-size:20px">20</div>',class:"dropdown-button",callback:function(){o.changeFontSize("20",o)}},{html:'<div style="font-size:24px">24</div>',class:"dropdown-button",callback:function(){o.changeFontSize("24",o)}},{html:'<div style="font-size:28px">28</div>',class:"dropdown-button",callback:function(){o.changeFontSize("28",o)}},{html:'<div style="font-size:32px">32</div>',class:"dropdown-button",callback:function(){o.changeFontSize("32",o)}},{html:'<div style="font-size:36px">36</div>',class:"dropdown-button",callback:function(){o.changeFontSize("36",o)}},{html:'<div style="font-size:40px">40</div>',class:"dropdown-button",callback:function(){o.changeFontSize("40",o)}}],n=document.getElementById("toolboxStylebutton_fontSize").getBoundingClientRect();t.createMenu(i,n.left,n.bottom)},t}(),__extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},Tool=function(){function t(t,e,o,i){this.__name=t,this.__svgicon=e,this.__altText=o,this.__styleSettings=i}return Object.defineProperty(t.prototype,"name",{get:function(){return this.__name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"svgIcon",{get:function(){return this.__svgicon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"altText",{get:function(){return this.__altText},enumerable:!0,configurable:!0}),t.prototype.toolSelected=function(){this.__isDrawing=!1},t.prototype.startDrawing=function(t,e){this.__isDirty=!0,this.__isDrawing=!0,this.__lastDrawingPosition=t,e&&(this.__tempImageData=getContextImgData(e))},t.prototype.stopDrawing=function(t,e){this.copyContextToSave(t,e),this.__isDrawing=!1,this.__lastDrawingPosition=null},t.prototype.copyContextToSave=function(t,e){var o=getContextImgData(t);clearCanvas(e),e.putImageData(o,0,0),this.__tempImageData=null,this.__isDirty=!1},t}(),Cursor=function(t){function e(e){var o='<svg width="20" height="20"><path d="M5 2 V 16 L 8 12 L 11 19 L 13 18 L 10 11 L 15.5 11.5 L 5 2" fill="transparent" stroke="black"/></svg>';t.call(this,"cursor",o,"Mouse",e)}return __extends(e,t),e.prototype.toolSelected=function(){t.prototype.toolSelected.call(this),this.__selectedRect=null,this.__isDragging=!1},e.prototype.startDrawing=function(e,o){o&&this.__isDirty&&this.__tempImageData&&(this.__selectedRect=null,clearCanvas(o),o.putImageData(this.__tempImageData,0,0)),t.prototype.startDrawing.call(this,e,o)},e.prototype.stopDrawing=function(e,o){clearCanvas(e),t.prototype.stopDrawing.call(this,e,o)},e.prototype.mouseDown=function(t,e,o){this.__selectedRect&&this.clickedInRect(t,this.__selectedRect)?(this.__isDragging=!0,this.__lastDrawingPosition=t,this.__dragData=o.getImageData(this.__selectedRect.pos.x,this.__selectedRect.pos.y,this.__selectedRect.width,this.__selectedRect.height),o.clearRect(this.__selectedRect.pos.x,this.__selectedRect.pos.y,this.__selectedRect.width,this.__selectedRect.height),this.__tempImageData=o.getImageData(0,0,e.canvas.width,e.canvas.height),e.putImageData(this.__tempImageData,0,0),e.putImageData(this.__dragData,this.__selectedRect.pos.x,this.__selectedRect.pos.y)):(this.startDrawing(t,e),this.__isDragging=!1,e.save(),e.setLineDash([5,5]),e.strokeStyle="black",e.lineWidth=1)},e.prototype.mouseMove=function(t,e,o){if(this.__isDragging)e.putImageData(this.__tempImageData,0,0),this.__selectedRect.pos.x+=t.x-this.__lastDrawingPosition.x,this.__selectedRect.pos.y+=t.y-this.__lastDrawingPosition.y,e.putImageData(this.__dragData,this.__selectedRect.pos.x,this.__selectedRect.pos.y),this.__lastDrawingPosition=t;else if(this.__isDrawing){clearCanvas(e),e.putImageData(this.__tempImageData,0,0),e.beginPath(),e.rect(this.__lastDrawingPosition.x,this.__lastDrawingPosition.y,t.x-this.__lastDrawingPosition.x,t.y-this.__lastDrawingPosition.y);var i=this.getCoordinates({pos:{x:this.__lastDrawingPosition.x,y:this.__lastDrawingPosition.y},width:t.x-this.__lastDrawingPosition.x,height:t.y-this.__lastDrawingPosition.y});this.__selectedRect||(this.__selectedRect={pos:{x:null,y:null},width:null,height:null}),this.__selectedRect.pos.x=i.left,this.__selectedRect.pos.y=i.top,this.__selectedRect.width=i.right-i.left,this.__selectedRect.height=i.bottom-i.top,e.stroke(),e.closePath()}},e.prototype.mouseUp=function(t,e,o){this.__isDragging&&(this.__selectedRect.pos.x+=t.x-this.__lastDrawingPosition.x,this.__selectedRect.pos.y+=t.y-this.__lastDrawingPosition.y,o.putImageData(this.__dragData,this.__selectedRect.pos.x,this.__selectedRect.pos.y),this.__tempImageData=getContextImgData(o),e.putImageData(this.__tempImageData,0,0),this.__lastDrawingPosition=null,this.__dragData=null,this.__selectedRect=null),this.__isDrawing=!1,this.__lastDrawingPosition=null,e.restore(),this.__isDragging=!1},e.prototype.keyPress=function(t,e,o){this.__selectedRect&&"Delete"===t.key&&(e.clearRect(this.__selectedRect.pos.x,this.__selectedRect.pos.y,this.__selectedRect.width,this.__selectedRect.height),o.clearRect(this.__selectedRect.pos.x,this.__selectedRect.pos.y,this.__selectedRect.width,this.__selectedRect.height),this.__tempImageData=getContextImgData(o))},e.prototype.clickedInRect=function(t,e){var o=this.getCoordinates(e);return t.x>=o.left&&t.x<=o.right&&t.y>=o.top&&t.y<=o.bottom},e.prototype.getCoordinates=function(t){var e,o,i,n;return t.width<0?(e=t.pos.x+t.width,o=t.pos.x):(e=t.pos.x,o=t.pos.x+t.width),t.height<0?(i=t.pos.y+t.height,n=t.pos.y):(i=t.pos.y,n=t.pos.y+t.height),{left:e,right:o,top:i,bottom:n}},e}(Tool),Pencil=function(t){function e(e){var o='<svg width="20" height="20"><path d="M3 5 L 8 2 L 15 13 L 15 19 L 10 16 L 3 5 M 4 7.5 L 10 4" fill="transparent" stroke="black"/></svg>';t.call(this,"pencil",o,".",e)}return __extends(e,t),e.prototype.mouseDown=function(t,e,o){this.startDrawing(t,e),e.beginPath(),e.fillStyle=e.strokeStyle,e.arc(this.__lastDrawingPosition.x,this.__lastDrawingPosition.y,this.__styleSettings.pixelWeight,0,2*Math.PI),e.fill()},e.prototype.mouseMove=function(t,e,o){this.__isDrawing&&(e.beginPath(),e.arc(t.x,t.y,this.__styleSettings.pixelWeight,0,2*Math.PI),e.fill(),this.__lastDrawingPosition=t)},e.prototype.mouseUp=function(t,e,o){e.restore(),this.stopDrawing(e,o)},e.prototype.keyPress=function(t,e,o){},e}(Tool),Line=function(t){function e(e){var o='<svg height="20" width="20"><line x1="0" y1="0" x2="20" y2="20" style="stroke:black;stroke-width:1" /></svg>';t.call(this,"line",o,"/",e)}return __extends(e,t),e.prototype.mouseDown=function(t,e,o){this.startDrawing(t,e)},e.prototype.mouseMove=function(t,e,o){this.__isDrawing&&(clearCanvas(e),e.putImageData(this.__tempImageData,0,0),e.beginPath(),e.moveTo(this.__lastDrawingPosition.x,this.__lastDrawingPosition.y),e.lineTo(t.x,t.y),e.stroke(),e.closePath())},e.prototype.mouseUp=function(t,e,o){this.stopDrawing(e,o)},e.prototype.keyPress=function(t,e,o){},e}(Tool),Scribble=function(t){function e(e){var o='<svg width="20" height="20"><path d="M0 10 Q 5 1, 10 10 T 20 10" stroke="black" fill="transparent"/></svg>';t.call(this,"scribble",o,"~",e)}return __extends(e,t),e.prototype.mouseDown=function(t,e,o){this.startDrawing(t)},e.prototype.mouseMove=function(t,e,o){this.__isDrawing&&(e.beginPath(),e.moveTo(this.__lastDrawingPosition.x,this.__lastDrawingPosition.y),e.lineTo(t.x,t.y),e.stroke(),this.__lastDrawingPosition=t)},e.prototype.mouseUp=function(t,e,o){this.stopDrawing(e,o)},e.prototype.keyPress=function(t,e,o){},e}(Tool),Square=function(t){function e(e){var o='<svg width="20" height="20"><rect x="0" y="0" width="20" height="20" stroke="black" stroke-width="1" fill="none" />';t.call(this,"square",o,"[]",e)}return __extends(e,t),e.prototype.mouseDown=function(t,e,o){this.startDrawing(t,e)},e.prototype.mouseMove=function(t,e,o){this.__isDrawing&&(clearCanvas(e),e.putImageData(this.__tempImageData,0,0),e.beginPath(),e.rect(this.__lastDrawingPosition.x,this.__lastDrawingPosition.y,t.x-this.__lastDrawingPosition.x,t.y-this.__lastDrawingPosition.y),"transparent"!==this.__styleSettings.fillColor.color&&e.fill(),e.stroke(),e.closePath())},e.prototype.mouseUp=function(t,e,o){this.stopDrawing(e,o)},e.prototype.keyPress=function(t,e,o){},e}(Tool),Circle=function(t){function e(e){var o='<svg width="20" height="20"><circle cx="10" cy="10" r="9" stroke="black" stroke-width="1" fill="none" />';t.call(this,"circle",o,"o",e)}return __extends(e,t),e.prototype.mouseDown=function(t,e,o){this.startDrawing(t,e)},e.prototype.mouseMove=function(t,e,o){this.__isDrawing&&(clearCanvas(e),e.putImageData(this.__tempImageData,0,0),this.drawEllipse(e,this.__lastDrawingPosition.x,this.__lastDrawingPosition.y,t.x-this.__lastDrawingPosition.x,t.y-this.__lastDrawingPosition.y))},e.prototype.mouseUp=function(t,e,o){this.stopDrawing(e,o)},e.prototype.keyPress=function(t,e,o){},e.prototype.drawEllipse=function(t,e,o,i,n){var s=i/2,l=n/2,a=e+s,c=o+l;t.beginPath();for(var r=0;r<2*Math.PI;r+=.01){var _=a+s*Math.cos(r),h=c+l*Math.sin(r);0===r?t.moveTo(_,h):t.lineTo(_,h)}"transparent"!==this.__styleSettings.fillColor.color&&t.fill(),t.stroke(),t.closePath()},e}(Tool),TextTool=function(t){function e(e){t.call(this,"text","","T",e)}return __extends(e,t),e.prototype.mouseDown=function(t,e,o){if(this.__textElem){if(this.__textElem){var i=this.__textElem.innerText;this.__textElem.clientWidth;e.save(),e.fillStyle="black",e.fillText(i,this.__lastDrawingPosition.x-3,this.__lastDrawingPosition.y+this.__styleSettings.font.size-5),document.getElementById("canvas-wrapper").removeChild(this.__textElem),this.__textElem=null,e.restore()}this.stopDrawing(e,o)}else{this.startDrawing(t,e),this.__textElem=document.createElement("div"),this.__textElem.setAttribute("class","canvas-textinput"),this.__textElem.setAttribute("contenteditable","true"),this.__textElem.setAttribute("style","left:"+this.__lastDrawingPosition.x+"px;top:"+this.__lastDrawingPosition.y+"px;font:"+this.__styleSettings.font.size+"px "+this.__styleSettings.font.name+";"),document.getElementById("canvas-wrapper").appendChild(this.__textElem);var n=this;window.setTimeout(function(){n.__textElem.focus()},0)}},e.prototype.mouseMove=function(t,e,o){},e.prototype.mouseUp=function(t,e,o){},e.prototype.keyPress=function(t,e,o){},e}(Tool),Eraser=function(t){function e(e){var o='<svg width="20" height="20"><path d="M0 0 H10 L 20 20 H 10 L 0 0" fill="pink" stroke="black"/></svg>';t.call(this,"eraser",o,"E",e)}return __extends(e,t),e.prototype.mouseDown=function(t,e,o){this.startDrawing(t)},e.prototype.mouseMove=function(t,e,o){this.__isDrawing&&e.clearRect(t.x-2*this.__styleSettings.pixelWeight,t.y-2*this.__styleSettings.pixelWeight,2*this.__styleSettings.pixelWeight,2*this.__styleSettings.pixelWeight)},e.prototype.mouseUp=function(t,e,o){this.stopDrawing(e,o)},e.prototype.keyPress=function(t,e,o){},e}(Tool);